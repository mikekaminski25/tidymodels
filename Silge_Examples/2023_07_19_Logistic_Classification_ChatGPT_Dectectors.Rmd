---
title: "Evaluate the performance of GPT detectors"
author: "Mike Kaminski"
date: "2023-09-28"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE,
                      message = FALSE, dpi = 180)
```

## Summary
This workbook focuses on the detection of text generated by large language models such as gpt-3 and gpt-4.  We'll delve into the realm of classification metrics and their application in evaluating GPT detectors.

The detectors are essentially models trained to differntiate between text produced by humans and text generated by GPT models.  The goal is to determine whether tet is AI or human.

## Explore data
```{r}
library(tidyverse)
tuesdata <- tidytuesdayR::tt_load(2023, week = 29)

detectors <- tuesdata$detectors
  
detectors$kind <- as.factor(detectors$kind)
detectors$.pred_class <- as.factor(detectors$.pred_class)
```

```{r}
detectors |>
  count(native, kind, .pred_class)
```

```{r}
detectors |>
  # filter(!is.na(native)) |>
  ggplot(aes(.pred_AI, fill = native)) +
  geom_histogram(show.legend = FALSE) +
  facet_wrap(vars(native), scales = "free_y", ncol = 1)
```
  Looking at the distribution of the predicted probablity
  
## Metrics that use a prediceted class

```{r}
library(yardstick)

detectors |>
  conf_mat(kind, .pred_class) |>
  autoplot()

```

```{r}
detectors |>
  accuracy(kind, .pred_class)
```
  
```{r}
detectors |>
  group_by(detector) |>
  accuracy(kind, .pred_class) 
```

```{r}
detectors |>
  group_by(native) |>
  accuracy(kind, .pred_class)
```
For native englis speakers, the accuracy is very high.  Very bad for the others.

```{r}
detectors |>
  group_by(native) |>
  sensitivity(kind, .pred_class)
```
This is the true positive rate

```{r}
detectors |>
  group_by(native) |>
  specificity(kind, .pred_class)
```

```{r}
detectors |>
  filter(!is.na(native)) |>
  conf_mat(kind, .pred_class)

```

## Metrics that use a predicted probability

```{r}
detectors |>
  group_by(detector) |>
  roc_curve(kind, .pred_AI) |>
  autoplot()
```

```{r}
detectors |>
  group_by(detector) |>
  roc_auc(kind, .pred_AI)
```

```{r}
detectors |>
  group_by(native, detector) |>
  mn_log_loss(kind, .pred_AI)
```




















